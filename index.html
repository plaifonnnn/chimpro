<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ChimPro</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    h2 { color: #444; }
    input, button, select {
      display: block; margin: 10px 0; padding: 10px; width: 100%; max-width: 400px;
    }
    .success { color: green; font-weight: bold; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ChimPro by ‡πÄ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πà</h2>
  <form id="registerForm">
    <input type="text" id="employeeId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" required>
    <input type="text" id="fullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
    <input type="text" id="nickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" required>
    <input type="text" id="storeCode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 121)" required>
    <input type="text" id="storeName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏°‡πá‡∏Ñ‡πÇ‡∏Ñ‡∏£‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà)" required>
    <button type="submit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <p id="message"></p>
  </form>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyce6KUSZheJBkVjP7nWYNOkwBtJaNMdo0Gw4XXCNE7wJbzBwbV2o95bD3_E8t0lUnehw/exec"; // üîÅ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Apps Script

    async function init() {
      await liff.init({ liffId: "<2007659572-ebXEGqkG>" }); // üîÅ ‡πÉ‡∏™‡πà LIFF ID ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô LINE Developers
      if (!liff.isLoggedIn()) liff.login();
    }

    init();

    document.getElementById("registerForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const msg = document.getElementById("message");
      msg.textContent = "";

      try {
        const profile = await liff.getProfile();
        const body = {
          lineUserId: profile.userId,
          employeeId: document.getElementById("employeeId").value,
          fullName: document.getElementById("fullName").value,
          nickname: document.getElementById("nickname").value,
          storeCode: document.getElementById("storeCode").value,
          storeName: document.getElementById("storeName").value
        };

        const res = await fetch(scriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        if (res.ok) {
          msg.textContent = "‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!";
          msg.className = "success";
          setTimeout(() => liff.closeWindow(), 2000);
        } else {
          throw new Error("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      } catch (err) {
        msg.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
        msg.className = "error";
      }
    });
  </script>
</body>
</html>
